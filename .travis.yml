sudo: required

# C overwrite our CC settings
language: generic

services:
    - docker

env:
    # cross compilation builds
    - DISTRO=debian.cross-compile.ppc64le TREE="out" BUILD="cross"
      compiler: powerpc64le-linux-gnu-gcc
    - DISTRO=debian.cross-compile.aarch64 TREE="out" BUILD="cross"
      compiler: aarch64-linux-gnu-gcc
    # 32 bit builds
    - DISTRO=debian.i386 BUILD="32"
      compiler: gcc
    - DISTRO=debian.i386 BUILD="32"
      compiler: clang

    - DISTRO=centos.latest
      compiler: gcc
    - DISTRO=centos6 TREE="out"
      compiler: gcc

    - DISTRO=debian.stable
      compiler: gcc
    - DISTRO=debian.stable TREE="out"
      compiler: clang

    - DISTRO=debian.minimal
      compiler: gcc
    - DISTRO=debian.minimal
      compiler: clang

    - DISTRO=debian.testing
      compiler: gcc
    - DISTRO=debian.testing
      compiler: clang

    - DISTRO=debian.oldstable
      compiler: gcc
    - DISTRO=debian.oldstable
      compiler: clang

    - DISTRO=ubuntu.latest TREE="out"
      compiler: gcc
    - DISTRO=ubuntu.latest
      compiler: clang

    - DISTRO=ubuntu.xenial
      compiler: gcc
    - DISTRO=ubuntu.xenial TREE="out"
      compiler: clang

    - DISTRO=tumbleweed
      compiler: gcc
    - DISTRO=tumbleweed
      compiler: clang

    - DISTRO=leap
      compiler: gcc
    - DISTRO=leap
      compiler: clang

    - DISTRO=fedora.latest TREE="out"
      compiler: gcc
    - DISTRO=fedora.latest
      compiler: clang

before_install:
    - docker build -f travis/Dockerfile.$DISTRO -t ltp .

script:
    - if [ ! "$TREE" ]; then TREE="in"; fi
    - if [ ! "$BUILD" ]; then BUILD="native"; fi
    - docker run -it ltp /bin/sh -c "cd travis && ./travis.$DISTRO.sh && ../build.sh -o $TREE -t $BUILD -c $CC"
